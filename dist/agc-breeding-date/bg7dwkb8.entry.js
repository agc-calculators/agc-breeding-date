/*! Built with http://stenciljs.com */
const{h:t}=window.AgcBreedingDate,e=(t,e)=>{"string"==typeof t&&(t=new Date(t));var a=new Date(t),i=t.getDate()+parseInt(e);return a.setDate(i),a},a=t=>{var e=new Date(t);return e.setMinutes(t.getMinutes()-t.getTimezoneOffset()),e.toJSON().slice(0,10)},i=(t,e="/")=>{let a=new Date(t);var i=a.getDate();return`${a.getMonth()+1}${e}${i}${e}${a.getFullYear()}`},s=(t,e)=>{var a=new Date(t),i=new Date(e);return Math.round((a.getTime()-i.getTime())/864e5)};class n{constructor(){this.socket="",this.tract="",this.shadow=!1,this.mode="step",this.currentStep=0,this.cache={},this.submitted=!1,this.results={}}render(){return t("div",null,t("form",{onSubmit:t=>t.preventDefault(),ref:t=>this.form=t,"data-wizard":"agc-breeding-date","data-wizard-mode":this.mode,class:`agc-wizard${this.shadow?" shadow":""}`},t("slot",null),t("section",{"data-wizard-section":"1"},t("div",{class:"agc-wizard__field"},t("label",{"data-i18n":"fields.calving-date"},"Calving Date"),t("input",{name:"calvingDate",type:"date",required:!0}),t("p",{class:"agc-wizard__validation-message","data-i18n":"validation.calving-date.required","data-validates":"calvingDate"},"Please enter a valid date."),t("p",{"data-i18n":"hints.calving-date"},"â®¤ Enter the calving date of the cow or heifer.")),"step"===this.mode&&t("div",{class:"agc-wizard__actions"},t("button",{class:"agc-wizard__actions-next","data-i18n":"actions.next",onClick:this.nextPrev.bind(this,1)},"Next ðŸ –"))),t("section",{"data-wizard-section":"2"},t("div",{class:"agc-wizard__field"},t("label",{"data-i18n":"fields.gestation-period"},"Gestation Period"),t("select",{name:"gestationPeriod"},t("option",{value:"279","data-i18n":"options.gestation-period.279"},"279 Days"),t("option",{value:"280","data-i18n":"options.gestation-period.280"},"280 Days"),t("option",{value:"281","data-i18n":"options.gestation-period.281"},"281 Days"),t("option",{value:"282","data-i18n":"options.gestation-period.282"},"282 Days"),t("option",{value:"283","data-i18n":"options.gestation-period.283",selected:!0},"283 Days"),t("option",{value:"284","data-i18n":"options.gestation-period.284"},"284 Days"),t("option",{value:"285","data-i18n":"options.gestation-period.285"},"285 Days"),t("option",{value:"286","data-i18n":"options.gestation-period.286"},"286 Days"),t("option",{value:"287","data-i18n":"options.gestation-period.287"},"287 Days")),t("p",null,"â®¤ Select the number of days in the gestation period.")),t("div",{class:"agc-wizard__actions"},"step"===this.mode&&t("button",{class:"agc-wizard__actions-back","data-i18n":"actions.back",onClick:this.nextPrev.bind(this,-1)},"ðŸ ” Back"),t("button",{class:"agc-wizard__actions-next","data-i18n":"actions.finish",onClick:this.nextPrev.bind(this,"step"===this.mode?1:2)},"Calculate ðŸ –"))),t("section",{"data-wizard-results":!0},t("slot",{name:"results"}))))}showTab(t){"step"===this.mode&&(this.cache.sections[t].style.display="block"),this.socket&&this.agcStepChanged.emit({socket:this.socket,tract:this.tract,step:this.currentStep})}reset(){this.currentStep=0,this.submitted=!1,this.showTab(0)}validateForm(){let t=!0;if(0===this.currentStep||"full"===this.mode){let e=this.form.querySelector('[name="calvingDate"]'),a=this.form.querySelector('[data-validates="calvingDate"');e.checkValidity()?(e.className=e.className.replace(" invalid",""),a.style.display="none"):(t=!1,-1===e.className.indexOf("invalid")&&(e.className+=" invalid"),a.style.display="block")}return t}nextPrev(t,e){if(e&&e.preventDefault(),"full"===this.mode){if(!this.validateForm())return!1}else if(1==t&&!this.validateForm())return!1;if("step"===this.mode&&(this.cache.sections[this.currentStep].style.display="none"),this.currentStep=this.currentStep+t,this.currentStep>=this.cache.sections.length)return this.submitted=!0,this.showResults.call(this),!1;this.showTab.call(this,this.currentStep)}showResults(){let t=this.form.querySelector('[name="calvingDate"').valueAsDate,a=parseInt(this.form.querySelector('[name="gestationPeriod"]').value),n=Math.floor(a/3),r=e(t,-a),d=s(r,new Date),o=s(t,new Date),l=s(new Date,r);d<0&&(d=0),l<0&&(l=0);let c=t<=new Date,u=l>0&&l<=a,h={id:"first",start:i(e(r,1),"/"),end:i(e(r,n),"/"),dayStart:1,dayEnd:n,isCurrent:l<=n},p={id:"second",start:i(e(r,n+1),"/"),end:i(e(r,2*n+1),"/"),dayStart:n+1,dayEnd:2*n,isCurrent:l>=n+1&&l<=2*n+1},g={id:"third",start:i(e(r,190),"/"),end:i(t,"/"),dayStart:2*n+1,dayEnd:a,isCurrent:l>=190},v=[h,p,g].filter(t=>t.isCurrent),m={socket:this.socket,tract:this.tract,breedingDate:i(r,"/"),daysTillBreeding:d,gestationPeriod:a,calvingDate:i(t,"/"),daysTillCalving:o,daysBred:l,firstPartition:h,secondPartition:p,thirdPartition:g,currentPartition:v.length?v[0].id:"",calved:c,bred:u,inputs:{breedingDate:{text:"Breeding Date",i18n:"results.breeding-date",type:"date",value:i(r,"/")},gestationPeriod:{text:"Gestation Period",i18n:"results.gestation-period",type:"number",value:a}},outputs:{calvingDate:{text:"Calving Date",i18n:"results.calving-date",type:"date",value:i(t,"/")},daysTillCalving:{text:"Days until Calving",i18n:"results.days-until-calving",type:"number",value:o},daysBred:{text:"Days Bred",i18n:"results.days-bred",type:"number",value:l},firstPartition:{text:"First Partition",i18n:"results.first-partition",type:"object",value:h,fields:{start:{text:"Start",i18n:"results.start-date",type:"date",value:h.start},end:{text:"End",i18n:"results.end-date",type:"date",value:h.end}}},secondPartition:{text:"Second Partition",i18n:"results.second-partition",type:"object",value:p,fields:{start:{text:"Start",i18n:"results.start-date",type:"date",value:p.start},end:{text:"End",i18n:"results.end-date",type:"date",value:p.end}}},thirdPartition:{text:"Third Partition",i18n:"results.third-partition",type:"object",value:g,fields:{start:{text:"Start",i18n:"results.start-date",type:"date",value:g.start},end:{text:"End",i18n:"results.end-date",type:"date",value:h.end}}}}};this.socket&&this.agcCalculated.emit({socket:this.socket,tract:this.tract,results:Object.assign({},m)}),this.results=Object.assign({},m),this.cache.results.forEach(t=>{t.style.display="block"})}handleAction(t){"reset"===t.detail.action&&this.reset()}componentDidLoad(){var t=Array.from(this.form.querySelectorAll("[data-wizard-section]")).map(t=>t).map(t=>t),e=Array.from(this.form.querySelectorAll("[data-wizard-results]")).map(t=>t).map(t=>t);this.cache=Object.assign({},this.cache,{sections:t,results:e}),window.document.addEventListener("agcAction",this.handleAction.bind(this)),this.form.querySelector('[name="calvingDate"]').defaultValue=a(new Date),this.showTab(0)}componentDidUnload(){window.document.removeEventListener("agcAction",this.handleAction)}static get is(){return"agc-breeding-date"}static get properties(){return{cache:{state:!0},currentStep:{state:!0},mode:{type:String,attr:"mode"},results:{state:!0},shadow:{type:Boolean,attr:"shadow"},socket:{type:String,attr:"socket"},submitted:{state:!0},tract:{type:String,attr:"tract"}}}static get events(){return[{name:"agcCalculated",method:"agcCalculated",bubbles:!0,cancelable:!0,composed:!0},{name:"agcStepChanged",method:"agcStepChanged",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return"agc-breeding-date *{-webkit-box-sizing:border-box;box-sizing:border-box}agc-breeding-date form{width:var(--agc-form-width,100%);margin:var(--agc-form-margin,0 auto);border:var(--agc-form-border-size,0) var(--agc-form-border-style,solid) var(--agc-form-border-color,#ebebeb);border-radius:var(--agc-form-border-radius,0);padding:var(--agc-form-padding,0);background-color:var(--agc-form-bg-color,#fff);color:var(--agc-form-color,#333)}agc-breeding-date form.shadow{-webkit-box-shadow:var(--agc-form-box-shadow,0 3px 6px rgba(0,0,0,.16),0 3px 6px rgba(0,0,0,.23));-moz-box-shadow:var(--agc-form-box-shadow,0 3px 6px rgba(0,0,0,.16),0 3px 6px rgba(0,0,0,.23));box-shadow:var(--agc-form-box-shadow,0 3px 6px rgba(0,0,0,.16),0 3px 6px rgba(0,0,0,.23))}agc-breeding-date [data-wizard-mode=step] [data-wizard-results],agc-breeding-date [data-wizard-mode=step] [data-wizard-section]{display:none}agc-breeding-date .agc-wizard__field{padding:var(--agc-wizard-field-padding,10px)}agc-breeding-date label{text-transform:var(--agc-form-label-text-transform,none);display:var(--agc-form-label-display,block);width:var(--agc-form-label-width,100%);margin:var(--agc-form-label-margin,0 0 5px 0)}agc-breeding-date input[type=date],agc-breeding-date input[type=text],agc-breeding-date select{padding:var(--agc-form-input-padding,10px);width:var(--agc-form-input-width,100%);font-size:var(--agc-form-input-font-size,17px);font-family:var(--agc-form-input-font-family,Raleway);border:var(--agc-form-input-border-size,1px) var(--agc-form-input-border-style,solid) var(--agc-form-input-border-color,#aaa)}agc-breeding-date button{background-color:var(--agc-form-button-bg-color,#4caf50);color:var(--agc-form-button-color,#fff);border:var(--agc-form-button-border,none);padding:var(--agc-form-button-padding,10px 20px);margin:var(--agc-form-button-margin,0);font-size:var(--agc-form-button-font-size,17px);font-family:var(--agc-form-button-font-family,Raleway);cursor:var(--agc-form-button-cursor,pointer);text-transform:var(--agc-form-button-text-transform,inherit)}agc-breeding-date .agc-wizard__actions{background-color:var(--agc-wizard-actions-bg-color,transparent);border-radius:var(--agc-wizard-actions-border-radius,0);margin:var(--agc-wizard-actions-margin,10px 0 0);padding:var(--agc-wizard-actions-padding,0 10px 10px);zoom:1}agc-breeding-date .agc-wizard__actions:after,agc-breeding-date .agc-wizard__actions:before{content:\"\";display:table}agc-breeding-date .agc-wizard__actions:after{content:\"\";display:table;clear:both}agc-breeding-date .agc-wizard__actions.centered{text-align:var(--agc-form-actions-centered-text-align,center)}agc-breeding-date button.agc-wizard__actions-next{float:right}agc-breeding-date button.agc-wizard__actions-back{background-color:var(--agc-form-back-button-bg-color,#999);color:var(--agc-form-back-button-color,#fff)}agc-breeding-date button:hover{opacity:.8}agc-breeding-date .agc-wizard__validation-message{display:none;color:var(--agc-form-validation-message-color,maroon)}agc-breeding-date input.invalid{border-color:var(--agc-form-input-error-border-color,maroon);background-color:var(--agc-form-input-error-background-color,#ffe5e5);color:var(--agc-form-input-error-color,maroon)}"}}export{n as AgcBreedingDate};