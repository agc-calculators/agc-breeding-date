/*! Built with http://stenciljs.com */
import{h}from"../agc-breeding-date.core.js";var oneDay=864e5,addDays=function(t,e){"string"==typeof t&&(t=new Date(t));var a=new Date(t),i=t.getDate()+parseInt(e);return a.setDate(i),a},inputDate=function(t){var e=new Date(t);return e.setMinutes(t.getMinutes()-t.getTimezoneOffset()),e.toJSON().slice(0,10)},formatDate=function(t,e){void 0===e&&(e="/");var a=new Date(t),i=a.getDate();return""+(a.getMonth()+1)+e+i+e+a.getFullYear()},daysBetween=function(t,e){var a=new Date(t),i=new Date(e);return Math.round((a.getTime()-i.getTime())/oneDay)},AgcBreedingDate=function(){function t(){this.socket="",this.tract="",this.shadow=!1,this.mode="step",this.currentStep=0,this.cache={},this.submitted=!1,this.results={}}return t.prototype.render=function(){var t=this;return h("div",null,h("form",{onSubmit:function(t){return t.preventDefault()},ref:function(e){return t.form=e},"data-wizard":"agc-breeding-date","data-wizard-mode":this.mode,class:"agc-wizard"+(this.shadow?" shadow":"")},h("slot",null),h("section",{"data-wizard-section":"1"},h("div",{class:"agc-wizard__field"},h("label",{"data-i18n":"fields.calving-date"},"Calving Date"),h("input",{name:"calvingDate",type:"date",required:!0}),h("p",{class:"agc-wizard__validation-message","data-i18n":"validation.calving-date.required","data-validates":"calvingDate"},"Please enter a valid date."),h("p",{"data-i18n":"hints.calving-date"},"â®¤ Enter the calving date of the cow or heifer.")),"step"===this.mode&&h("div",{class:"agc-wizard__actions"},h("button",{class:"agc-wizard__actions-next","data-i18n":"actions.next",onClick:this.nextPrev.bind(this,1)},"Next ðŸ –"))),h("section",{"data-wizard-section":"2"},h("div",{class:"agc-wizard__field"},h("label",{"data-i18n":"fields.gestation-period"},"Gestation Period"),h("select",{name:"gestationPeriod"},h("option",{value:"279","data-i18n":"options.gestation-period.279"},"279 Days"),h("option",{value:"280","data-i18n":"options.gestation-period.280"},"280 Days"),h("option",{value:"281","data-i18n":"options.gestation-period.281"},"281 Days"),h("option",{value:"282","data-i18n":"options.gestation-period.282"},"282 Days"),h("option",{value:"283","data-i18n":"options.gestation-period.283",selected:!0},"283 Days"),h("option",{value:"284","data-i18n":"options.gestation-period.284"},"284 Days"),h("option",{value:"285","data-i18n":"options.gestation-period.285"},"285 Days"),h("option",{value:"286","data-i18n":"options.gestation-period.286"},"286 Days"),h("option",{value:"287","data-i18n":"options.gestation-period.287"},"287 Days")),h("p",null,"â®¤ Select the number of days in the gestation period.")),h("div",{class:"agc-wizard__actions"},"step"===this.mode&&h("button",{class:"agc-wizard__actions-back","data-i18n":"actions.back",onClick:this.nextPrev.bind(this,-1)},"ðŸ ” Back"),h("button",{class:"agc-wizard__actions-next","data-i18n":"actions.finish",onClick:this.nextPrev.bind(this,"step"===this.mode?1:2)},"Calculate ðŸ –"))),h("section",{"data-wizard-results":!0},h("slot",{name:"results"}))))},t.prototype.showTab=function(t){"step"===this.mode&&(this.cache.sections[t].style.display="block"),this.socket&&this.agcStepChanged.emit({socket:this.socket,tract:this.tract,step:this.currentStep})},t.prototype.reset=function(){this.currentStep=0,this.submitted=!1,this.showTab(0)},t.prototype.validateForm=function(){var t=!0;if(0===this.currentStep||"full"===this.mode){var e=this.form.querySelector('[name="calvingDate"]'),a=this.form.querySelector('[data-validates="calvingDate"');e.checkValidity()?(e.className=e.className.replace(" invalid",""),a.style.display="none"):(t=!1,-1===e.className.indexOf("invalid")&&(e.className+=" invalid"),a.style.display="block")}return t},t.prototype.nextPrev=function(t,e){if(e&&e.preventDefault(),"full"===this.mode){if(!this.validateForm())return!1}else if(1==t&&!this.validateForm())return!1;if("step"===this.mode&&(this.cache.sections[this.currentStep].style.display="none"),this.currentStep=this.currentStep+t,this.currentStep>=this.cache.sections.length)return this.submitted=!0,this.showResults.call(this),!1;this.showTab.call(this,this.currentStep)},t.prototype.showResults=function(){var t=this.form.querySelector('[name="calvingDate"').valueAsDate,e=parseInt(this.form.querySelector('[name="gestationPeriod"]').value),a=Math.floor(e/3),i=addDays(t,-e),n=daysBetween(i,new Date),s=daysBetween(t,new Date),r=daysBetween(new Date,i);n<0&&(n=0),r<0&&(r=0);var o=t<=new Date,d=r>0&&r<=e,c={id:"first",start:formatDate(addDays(i,1),"/"),end:formatDate(addDays(i,a),"/"),dayStart:1,dayEnd:a,isCurrent:r<=a},l={id:"second",start:formatDate(addDays(i,a+1),"/"),end:formatDate(addDays(i,2*a+1),"/"),dayStart:a+1,dayEnd:2*a,isCurrent:r>=a+1&&r<=2*a+1},u={id:"third",start:formatDate(addDays(i,190),"/"),end:formatDate(t,"/"),dayStart:2*a+1,dayEnd:e,isCurrent:r>=190},h=[c,l,u].filter(function(t){return t.isCurrent}),p={socket:this.socket,tract:this.tract,breedingDate:formatDate(i,"/"),daysTillBreeding:n,gestationPeriod:e,calvingDate:formatDate(t,"/"),daysTillCalving:s,daysBred:r,firstPartition:c,secondPartition:l,thirdPartition:u,currentPartition:h.length?h[0].id:"",calved:o,bred:d,inputs:{breedingDate:{text:"Breeding Date",i18n:"results.breeding-date",type:"date",value:formatDate(i,"/")},gestationPeriod:{text:"Gestation Period",i18n:"results.gestation-period",type:"number",value:e}},outputs:{calvingDate:{text:"Calving Date",i18n:"results.calving-date",type:"date",value:formatDate(t,"/")},daysTillCalving:{text:"Days until Calving",i18n:"results.days-until-calving",type:"number",value:s},daysBred:{text:"Days Bred",i18n:"results.days-bred",type:"number",value:r},firstPartition:{text:"First Partition",i18n:"results.first-partition",type:"object",value:c,fields:{start:{text:"Start",i18n:"results.start-date",type:"date",value:c.start},end:{text:"End",i18n:"results.end-date",type:"date",value:c.end}}},secondPartition:{text:"Second Partition",i18n:"results.second-partition",type:"object",value:l,fields:{start:{text:"Start",i18n:"results.start-date",type:"date",value:l.start},end:{text:"End",i18n:"results.end-date",type:"date",value:l.end}}},thirdPartition:{text:"Third Partition",i18n:"results.third-partition",type:"object",value:u,fields:{start:{text:"Start",i18n:"results.start-date",type:"date",value:u.start},end:{text:"End",i18n:"results.end-date",type:"date",value:c.end}}}}};this.socket&&this.agcCalculated.emit({socket:this.socket,tract:this.tract,results:Object.assign({},p)}),this.results=Object.assign({},p),this.cache.results.forEach(function(t){t.style.display="block"})},t.prototype.handleAction=function(t){"reset"===t.detail.action&&this.reset()},t.prototype.componentDidLoad=function(){var t=Array.from(this.form.querySelectorAll("[data-wizard-section]")).map(function(t){return t}).map(function(t){return t}),e=Array.from(this.form.querySelectorAll("[data-wizard-results]")).map(function(t){return t}).map(function(t){return t});this.cache=Object.assign({},this.cache,{sections:t,results:e}),window.document.addEventListener("agcAction",this.handleAction.bind(this)),this.form.querySelector('[name="calvingDate"]').defaultValue=inputDate(new Date),this.showTab(0)},t.prototype.componentDidUnload=function(){window.document.removeEventListener("agcAction",this.handleAction)},Object.defineProperty(t,"is",{get:function(){return"agc-breeding-date"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"properties",{get:function(){return{cache:{state:!0},currentStep:{state:!0},mode:{type:String,attr:"mode"},results:{state:!0},shadow:{type:Boolean,attr:"shadow"},socket:{type:String,attr:"socket"},submitted:{state:!0},tract:{type:String,attr:"tract"}}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"events",{get:function(){return[{name:"agcCalculated",method:"agcCalculated",bubbles:!0,cancelable:!0,composed:!0},{name:"agcStepChanged",method:"agcStepChanged",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"style",{get:function(){return"agc-breeding-date *{-webkit-box-sizing:border-box;box-sizing:border-box}agc-breeding-date form{width:var(--agc-form-width,100%);margin:var(--agc-form-margin,0 auto);border:var(--agc-form-border-size,0) var(--agc-form-border-style,solid) var(--agc-form-border-color,#ebebeb);border-radius:var(--agc-form-border-radius,0);padding:var(--agc-form-padding,0);background-color:var(--agc-form-bg-color,#fff);color:var(--agc-form-color,#333)}agc-breeding-date form.shadow{-webkit-box-shadow:var(--agc-form-box-shadow,0 3px 6px rgba(0,0,0,.16),0 3px 6px rgba(0,0,0,.23));-moz-box-shadow:var(--agc-form-box-shadow,0 3px 6px rgba(0,0,0,.16),0 3px 6px rgba(0,0,0,.23));box-shadow:var(--agc-form-box-shadow,0 3px 6px rgba(0,0,0,.16),0 3px 6px rgba(0,0,0,.23))}agc-breeding-date [data-wizard-mode=step] [data-wizard-results],agc-breeding-date [data-wizard-mode=step] [data-wizard-section]{display:none}agc-breeding-date .agc-wizard__field{padding:var(--agc-wizard-field-padding,10px)}agc-breeding-date label{text-transform:var(--agc-form-label-text-transform,none);display:var(--agc-form-label-display,block);width:var(--agc-form-label-width,100%);margin:var(--agc-form-label-margin,0 0 5px 0)}agc-breeding-date input[type=date],agc-breeding-date input[type=text],agc-breeding-date select{padding:var(--agc-form-input-padding,10px);width:var(--agc-form-input-width,100%);font-size:var(--agc-form-input-font-size,17px);font-family:var(--agc-form-input-font-family,Raleway);border:var(--agc-form-input-border-size,1px) var(--agc-form-input-border-style,solid) var(--agc-form-input-border-color,#aaa)}agc-breeding-date button{background-color:var(--agc-form-button-bg-color,#4caf50);color:var(--agc-form-button-color,#fff);border:var(--agc-form-button-border,none);padding:var(--agc-form-button-padding,10px 20px);margin:var(--agc-form-button-margin,0);font-size:var(--agc-form-button-font-size,17px);font-family:var(--agc-form-button-font-family,Raleway);cursor:var(--agc-form-button-cursor,pointer);text-transform:var(--agc-form-button-text-transform,inherit)}agc-breeding-date .agc-wizard__actions{background-color:var(--agc-wizard-actions-bg-color,transparent);border-radius:var(--agc-wizard-actions-border-radius,0);margin:var(--agc-wizard-actions-margin,10px 0 0);padding:var(--agc-wizard-actions-padding,0 10px 10px);zoom:1}agc-breeding-date .agc-wizard__actions:after,agc-breeding-date .agc-wizard__actions:before{content:\"\";display:table}agc-breeding-date .agc-wizard__actions:after{content:\"\";display:table;clear:both}agc-breeding-date .agc-wizard__actions.centered{text-align:var(--agc-form-actions-centered-text-align,center)}agc-breeding-date button.agc-wizard__actions-next{float:right}agc-breeding-date button.agc-wizard__actions-back{background-color:var(--agc-form-back-button-bg-color,#999);color:var(--agc-form-back-button-color,#fff)}agc-breeding-date button:hover{opacity:.8}agc-breeding-date .agc-wizard__validation-message{display:none;color:var(--agc-form-validation-message-color,maroon)}agc-breeding-date input.invalid{border-color:var(--agc-form-input-error-border-color,maroon);background-color:var(--agc-form-input-error-background-color,#ffe5e5);color:var(--agc-form-input-error-color,maroon)}"},enumerable:!0,configurable:!0}),t}();export{AgcBreedingDate};